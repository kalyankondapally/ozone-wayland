From 9ca98da5d4ba8c302312cfc3aae849bca58d9153 Mon Sep 17 00:00:00 2001
From: Kondapally Kalyan <kalyan.kondapally@intel.com>
Date: Sun, 13 Oct 2013 00:50:46 +0300
Subject: [PATCH 03/11] system key event listener

---
 .../browser/chromeos/system_key_event_listener.cc  |   12 ++++++++++--
 .../browser/chromeos/system_key_event_listener.h   |    3 ++-
 2 files changed, 12 insertions(+), 3 deletions(-)

diff --git a/chrome/browser/chromeos/system_key_event_listener.cc b/chrome/browser/chromeos/system_key_event_listener.cc
index d148977..75775fa 100644
--- a/chrome/browser/chromeos/system_key_event_listener.cc
+++ b/chrome/browser/chromeos/system_key_event_listener.cc
@@ -12,8 +12,10 @@
 
 #include "base/message_loop/message_loop.h"
 #include "chromeos/ime/input_method_manager.h"
+#if defined(USE_X11)
 #include "chromeos/ime/xkeyboard.h"
 #include "ui/base/x/x11_util.h"
+#endif
 
 namespace chromeos {
 
@@ -46,6 +48,7 @@ SystemKeyEventListener::SystemKeyEventListener()
       num_lock_mask_(0),
       pressed_modifiers_(0),
       xkb_event_base_(0) {
+#if defined(USE_X11)
   input_method::XKeyboard* xkeyboard =
       input_method::InputMethodManager::Get()->GetXKeyboard();
   num_lock_mask_ = xkeyboard->GetNumLockMask();
@@ -68,7 +71,7 @@ SystemKeyEventListener::SystemKeyEventListener()
                        XkbStateNotifyMask)) {
     LOG(WARNING) << "Could not install Xkb Indicator observer";
   }
-
+#endif
   base::MessageLoopForUI::current()->AddObserver(this);
 }
 
@@ -103,7 +106,11 @@ void SystemKeyEventListener::RemoveModifiersObserver(
 
 base::EventStatus SystemKeyEventListener::WillProcessEvent(
     const base::NativeEvent& event) {
+#if defined(USE_X11)
   return ProcessedXEvent(event) ? base::EVENT_HANDLED : base::EVENT_CONTINUE;
+#else
+  return base::EVENT_CONTINUE;
+#endif
 }
 
 void SystemKeyEventListener::DidProcessEvent(const base::NativeEvent& event) {
@@ -121,6 +128,7 @@ void SystemKeyEventListener::OnModifiers(int state) {
                     OnModifiersChange(state));
 }
 
+#if defined(USE_X11)
 bool SystemKeyEventListener::ProcessedXEvent(XEvent* xevent) {
   input_method::InputMethodManager* input_method_manager =
       input_method::InputMethodManager::Get();
@@ -157,5 +165,5 @@ bool SystemKeyEventListener::ProcessedXEvent(XEvent* xevent) {
   }
   return false;
 }
-
+#endif
 }  // namespace chromeos
diff --git a/chrome/browser/chromeos/system_key_event_listener.h b/chrome/browser/chromeos/system_key_event_listener.h
index b281aa0..0a0773a 100644
--- a/chrome/browser/chromeos/system_key_event_listener.h
+++ b/chrome/browser/chromeos/system_key_event_listener.h
@@ -74,9 +74,10 @@ class SystemKeyEventListener : public base::MessageLoopForUI::Observer {
 
   void OnCapsLock(bool enabled);
   void OnModifiers(int state);
-
+#if defined(USE_X11)
   // Returns true if the event was processed, false otherwise.
   virtual bool ProcessedXEvent(XEvent* xevent);
+#endif
 
   bool stopped_;
 
-- 
1.7.9.5

